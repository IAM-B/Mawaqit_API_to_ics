<!-- Planner Page Template - Synchronized Schedule -->
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>🕌 Planning synchronisé</title>
    <!-- Favicon and stylesheet links -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="/static/css/styles.css" />
    <!-- Timeline JavaScript -->
    <script src="/static/js/timeline.js"></script>
  </head>
  <body>
    <main class="container">
      <h1 class="page-title">🕌 Emploi du temps synchronisé</h1>

      <section class="form">
        <fieldset class="form-section">
          <legend>📌 Informations Générales</legend>

          <!-- Timezone information -->
          <label>Fuseau horaire détecté :</label>
          <ul>
            <li>{{ timezone_str }}</li>
          </ul>

          {% if segments %}
          <!-- Hidden configuration for timeline -->
          <div id="timelineConfig" 
               data-segments='{{ segments|tojson|safe }}'
               data-scope="{{ scope }}"
               style="display: none;">
          </div>

          <!-- Timeline section -->
          <section class="timeline-section">
            <h2>🕒 Timeline</h2>
            <div class="timeline-navigation">
              <button id="prevBtn" class="timeline-nav-btn">←</button>
              <span id="currentDate"></span>
              <button id="nextBtn" class="timeline-nav-btn">→</button>
            </div>
            <div id="timelineContent" class="timeline-container">
              <div class="timeline-hours"></div>
            </div>
          </section>

          <!-- Available slots section -->
          <section class="available-slots">
            <h2>🕒 Créneaux disponibles</h2>
            <div id="availableSlotsList">
              <!-- Slots will be displayed here dynamically -->
            </div>
          </section>

          <!-- Timeline initialization script -->
          <script>
            // Timeline configuration
            const timelineConfig = document.getElementById('timelineConfig');
            const timelineData = JSON.parse(timelineConfig.dataset.segments);
            const timelineScope = timelineConfig.dataset.scope;

            // Initialize timeline
            const timeline = new Timeline('timelineContent', timelineData, timelineScope);

            // Navigation event listeners
            document.getElementById('prevBtn').addEventListener('click', () => timeline.navigate(-1));
            document.getElementById('nextBtn').addEventListener('click', () => timeline.navigate(1));
          </script>

          <!-- Manual slot editing button -->
          <boutton class="btn-submit">
            <a href="/edit_slot">✏️ Modifier un créneau manuellement</a>
          </boutton>
          
          {% else %}
          <p>Aucun créneau disponible détecté pour la période sélectionnée.</p>
          {% endif %}
        </fieldset>

        <!-- Downloadable files section -->
        <fieldset class="form-section">
          <legend>📂 Fichiers téléchargeables</legend>

          <!-- Prayer times ICS file -->
          {% if ics_path %}
          <boutton class="btn-submit"
            ><a href="{{ url_for('static', filename='ics/' + ics_path) }}" download
              >📥 Télécharger les horaires de prière (.ics)</a
            ></boutton
          >
          {% endif %} 

          <!-- Available slots ICS file -->
          {% if empty_slots_path %}
          <boutton class="btn-submit"
            ><a href="{{ url_for('static', filename='ics/' + empty_slots_path) }}" download
              >📥 Télécharger les créneaux disponibles (.ics)</a
            ></boutton
          >
          {% endif %} 

          <!-- Synchronized slots ICS file -->
          {% if available_slots_path %}
          <boutton class="btn-submit"
            ><a href="{{ url_for('static', filename='ics/' + available_slots_path) }}" download
              >📥 Télécharger les créneaux synchronisés (.ics)</a
            ></boutton
          >
          {% endif %}
        </fieldset>
      </section>
    </main>
  </body>
</html>
