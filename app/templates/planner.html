<!-- TEST-ID: planner-page -->
<!-- Planner Page Template - Synchronized Schedule -->
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>üïå Planning synchronis√©</title>
    <!-- Favicon and stylesheet links -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/planner.css') }}" />
    <!-- Font Awesome pour les ic√¥nes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- External CSS Libraries -->
    <!-- Tom Select for enhanced dropdowns -->
    <link
      href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.css"
      rel="stylesheet"l
    />
    <!-- Leaflet for map functionality -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- MarkerCluster for map markers -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
    />
    <!-- Timeline JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  </head>
  <body class="page-transition">
    <main class="container">
      <!-- Header avec breadcrumb et titre -->
      <header class="page-header fade-in-up">
        <h1 class="page-title"><i class="fa-solid fa-mosque"></i> Planning synchronis√©</h1>
        <nav class="breadcrumb">
          <a href="/">Accueil</a> &gt; <span>Planning synchronis√©</span>
        </nav>
      </header>

      <!-- Barre de progression -->
      <div class="progress-indicator fade-in-up">
        <div class="progress-step active"><i class="fa-solid fa-mosque"></i> S√©lection</div>
        <div class="progress-step"><i class="fa-solid fa-cog"></i> Configuration</div>
        <div class="progress-step"><i class="fa-regular fa-clock"></i> Horaires</div>
        <div class="progress-step"><i class="fa-solid fa-download"></i> T√©l√©chargement</div>
      </div>

      <!-- Nouvelle grille principale -->
      <div class="planner-main-grid">
        <section class="summary-section">
          <div class="summary-grid">
            <div class="summary-card mosque-info">
              <h3><i class="fa-solid fa-mosque"></i> S√©lection de mosqu√©e</h3>
              
              <!-- Map container -->
              <div
                id="mosque-map"
                style="height: 400px; margin: 1em 0; border-radius: 8px"
              ></div>

              <!-- Mosque selection form -->
              <form class="form" id="plannerForm">
                <!-- Country selection -->
                <label for="country-select">Pays :</label>
                <select id="country-select" name="country" autocomplete="off">
                  <option value="">-- S√©lectionner un pays --</option>
                </select>

                <!-- Mosque selection -->
                <label for="mosque-select">Mosqu√©e :</label>
                <select
                  id="mosque-select"
                  name="masjid_id"
                  autocomplete="off"
                  disabled
                >
                  <option value="">-- S√©lectionner une mosqu√©e --</option>
                </select>

                <!-- Hidden fields for mosque coordinates -->
                <input type="hidden" id="mosque_lat" name="mosque_lat" value="" />
                <input type="hidden" id="mosque_lng" name="mosque_lng" value="" />
                <input type="hidden" id="mosque_name" name="mosque_name" value="" />
                <input type="hidden" id="mosque_address" name="mosque_address" value="" />

                <!-- Hidden scope field - always year -->
                <input type="hidden" name="scope" value="year" />
              </form>
            </div>
            <div class="summary-card config-info">
              <h3><i class="fa-solid fa-cog"></i> Configuration</h3>
              
              <!-- Configuration form -->
              <form class="form" id="configForm">
                <!-- Prayer time padding settings -->
                <label for="padding_before">Temps avant pri√®re (min) :</label>
                <input type="number" name="padding_before" value="10" min="0" />

                <label for="padding_after">Temps apr√®s pri√®re (min) :</label>
                <input type="number" name="padding_after" value="35" min="0" />

                <!-- New checkbox for sunset -->
                <label for="include_sunset">
                  <input type="checkbox" name="include_sunset" id="include_sunset" checked />
                  Inclure le sunset (chourouk) dans les ICS
                </label>

                <!-- Submit button -->
                <button type="submit" class="btn-submit" aria-label="G√©n√©rer planning">
                  üì• G√©n√©rer planning
                </button>
              </form>

          </div>
        </section>
        <section class="clock-section">
          <h2><i class="fa-regular fa-calendar"></i> Agenda des pri√®res</h2>
          <div class="clock-layout">
            <!-- Left half: defaultSlotsView -->
            <div class="slots-half">
              <div class="slots-header">
                <button id="prevDayBtn" class="calendar-nav-btn" aria-label="Jour pr√©c√©dent">‚Üê</button>
                <h3 id="slotsCurrentDate" class="calendar-title"></h3>
                <button id="nextDayBtn" class="calendar-nav-btn" aria-label="Jour suivant">‚Üí</button>
              </div>
              <div class="slots-timeline-container">
                <svg class="slots-timeline-svg" viewBox="0 0 400 1440" preserveAspectRatio="none">
                  <!-- Grille, labels et √©v√©nements seront g√©n√©r√©s par JS -->
                </svg>
                <div id="slotsListFallback" class="slots-list-fallback" style="display: none;">
                  <!-- Liste textuelle des cr√©neaux si SVG indisponible -->
                </div>
              </div>
            </div>
            
            <!-- Right half: clockCalendar and clockContent -->
            <div class="clock-half">
              <div id="clockCalendar" class="clock-calendar">
                <div class="calendar-header">
                  <button id="prevMonthBtn" class="calendar-nav-btn">‚Üê</button>
                  <h3 id="currentMonthTitle" class="calendar-title"></h3>
                  <button id="nextMonthBtn" class="calendar-nav-btn">‚Üí</button>
                </div>
                <div class="calendar-grid">
                  <div class="calendar-weekdays">
                    <div class="weekday">Lun</div>
                    <div class="weekday">Mar</div>
                    <div class="weekday">Mer</div>
                    <div class="weekday">Jeu</div>
                    <div class="weekday">Ven</div>
                    <div class="weekday">Sam</div>
                    <div class="weekday">Dim</div>
                  </div>
                  <div id="clockCalendarDays" class="calendar-days">
                    <!-- Calendar days will be generated here -->
                  </div>
                </div>
              </div>
              <div id="clockContent" class="clock-container">
                <!-- Clock will be rendered here -->
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Le reste en dessous -->
      <section class="quick-actions">
        <h2><i class="fa-solid fa-download"></i> T√©l√©chargements rapides</h2>
        <div class="download-grid">
          {% if ics_path %}
          <a href="{{ url_for('static', filename='ics/' + ics_path) }}" download class="download-card primary">
            <span class="download-icon"><i class="fa-regular fa-calendar"></i></span>
            <span class="download-title">Horaires de pri√®re</span>
            <span class="download-format">.ics</span>
          </a>
          {% endif %}
          {% if available_slots_path %}
          <a href="{{ url_for('static', filename='ics/' + available_slots_path) }}" download class="download-card secondary">
            <span class="download-icon"><i class="fa-regular fa-clock"></i></span>
            <span class="download-title">Cr√©neaux synchronis√©s</span>
            <span class="download-format">.ics</span>
          </a>
          {% endif %}
          {% if empty_slots_path %}
          <a href="{{ url_for('static', filename='ics/' + empty_slots_path) }}" download class="download-card secondary">
            <span class="download-icon"><i class="fa-regular fa-clipboard"></i></span>
            <span class="download-title">Cr√©neaux disponibles</span>
            <span class="download-format">.ics</span>
          </a>
          {% endif %}
          <a href="/edit_slot" class="download-card edit">
            <span class="download-icon"><i class="fa-solid fa-pen"></i></span>
            <span class="download-title">Modifier manuellement</span>
            <span class="download-format">Cr√©neaux</span>
          </a>
        </div>
      </section>
      
      <!-- Bloc de config cach√© pour l'horloge -->
      {% if segments %}
      <div id="clockConfig" 
           data-segments='{{ segments|tojson|safe }}'
           data-scope="{{ scope }}"
           style="display: none;">
      </div>
      {% endif %}
    </main>

    <!-- External JavaScript Libraries -->
    <!-- Leaflet for map functionality -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- MarkerCluster for map markers -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <!-- Tom Select for enhanced dropdowns -->
    <script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
    
    <!-- Local JavaScript files -->
    <script src="{{ url_for('static', filename='js/planner.js') }}"></script>
  </body>
</html>
